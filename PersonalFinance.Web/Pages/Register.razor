@page "/register"
@layout MainLayout
@using System.ComponentModel.DataAnnotations

<div class="form-container">
    <div class="form-card">
        <h1 class="form-title">Регистрация</h1>
        <p class="form-subtitle">Создайте аккаунт для управления финансами</p>

        <EditForm Model="@RegisterModel" OnValidSubmit="@HandleRegister">
            <DataAnnotationsValidator />

            <div class="form-group">
                <label class="form-label">Имя пользователя</label>
                <div class="input-with-icon">
                    <span class="input-icon">👤</span>
                    <InputText @bind-Value="RegisterModel.Username"
                               class="@GetInputClass("Username")"
                               placeholder="Введите имя пользователя" />
                </div>
                <ValidationMessage For="@(() => RegisterModel.Username)" class="validation-message" />
            </div>

            <div class="form-group">
                <label class="form-label">Email</label>
                <div class="input-with-icon">
                    <span class="input-icon">📧</span>
                    <InputText @bind-Value="RegisterModel.Email"
                               class="@GetInputClass("Email")"
                               placeholder="example@email.com" />
                </div>
                <ValidationMessage For="@(() => RegisterModel.Email)" class="validation-message" />
            </div>

            <div class="form-group">
                <label class="form-label">Пароль</label>
                <div class="input-with-icon">
                    <span class="input-icon">🔒</span>
                    <InputText type="password"
                               @bind-Value="RegisterModel.Password"
                               class="@GetInputClass("Password")"
                               placeholder="Минимум 6 символов" />
                </div>
                <ValidationMessage For="@(() => RegisterModel.Password)" class="validation-message" />
            </div>

            <div class="form-group">
                <label class="form-label">Подтвердите пароль</label>
                <div class="input-with-icon">
                    <span class="input-icon">🔒</span>
                    <InputText type="password"
                               @bind-Value="RegisterModel.ConfirmPassword"
                               class="@GetInputClass("ConfirmPassword")"
                               placeholder="Повторите пароль" />
                </div>
                <ValidationMessage For="@(() => RegisterModel.ConfirmPassword)" class="validation-message" />
            </div>

            <button type="submit" class="form-button">
                Зарегистрироваться
            </button>
        </EditForm>

        <div class="form-footer">
            Уже есть аккаунт?
            <a href="/login" class="form-link">Войти</a>
        </div>
    </div>
</div>

@code {
    private RegisterInputModel RegisterModel { get; set; } = new();
    private List<string> ValidationErrors { get; set; } = new();

    private void HandleRegister()
    {
        ValidationErrors.Clear();

        // Здесь будет ваша логика регистрации
        Console.WriteLine($"Регистрация: {RegisterModel.Username}, {RegisterModel.Email}");

        // Пример: переход на главную после успешной регистрации
        NavigationManager.NavigateTo("/");
    }

    private string GetInputClass(string fieldName)
    {
        return IsInvalid(fieldName) ? "form-input invalid" : "form-input";
    }

    private bool IsInvalid(string fieldName)
    {
        return ValidationErrors.Contains(fieldName);
    }

    public class RegisterInputModel
    {
        [Required(ErrorMessage = "Обязательное поле")]
        [MinLength(3, ErrorMessage = "Минимум 3 символа")]
        [MaxLength(20, ErrorMessage = "Максимум 20 символов")]
        public string Username { get; set; } = "";

        [Required(ErrorMessage = "Обязательное поле")]
        [EmailAddress(ErrorMessage = "Введите корректный email")]
        public string Email { get; set; } = "";

        [Required(ErrorMessage = "Обязательное поле")]
        [MinLength(6, ErrorMessage = "Минимум 6 символов")]
        public string Password { get; set; } = "";

        [Required(ErrorMessage = "Обязательное поле")]
        [Compare(nameof(Password), ErrorMessage = "Пароли не совпадают")]
        public string ConfirmPassword { get; set; } = "";
    }

    [Inject] private NavigationManager NavigationManager { get; set; } = default!;
}